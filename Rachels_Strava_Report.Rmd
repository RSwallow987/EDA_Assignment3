---
title: "Rachel's Strava App"
author: "Rachel Swallow"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: html_document
    toc: true
    toc_depth: 4
    theme: paper 
    df_print: paged
runtime: shiny
---


One can get fancy with allowing the user a lot of flexibility in terms of how they choose the various filters and splits. But you've captured the main idea nicely. 

Best to change the column headings to something more text like ("Split time" rather than "splittime" etc).

I'm not sure if this is an actual run but if so just double check your distance and time calculations because your speeds seem off. I've only looked at a few runs but they're like 50 mins for 10-12k, so not 1-2 min per km.

Not sure why things are slow to recalculate... once you've filtered out the last few runs, which is fast, then the other operations are just averages, so should be fast too. One thing is that st_distance can be slow, so you might want to code the distance calculation yourself.

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.height=5,
                      fig.align='center',              tidy.opts=list(width.cutoff=60),
                      tidy=TRUE, 
                     warning = FALSE,echo=FALSE,comment=NA)
library(knitr)
library(tinytex)
library(ggplot2)
library(dplyr)
library(tidyverse)
library(lubridate)
library(rmarkdown)
library(ggrepel)
library(reshape2)
library(raster)
```
### Plagerism Declaration
I understand the meaning of plagiarism and I declare that all of the work presented here in this report is my own, unless properly acknowledged. 

### Assignment Description 
\marginpar{\bf{[15]}}

```{r loadingdata}
#Load data into a R object list 
directory <- ("./data/data")
specdatafiles<-as.character(list.files(directory))
specdatapaths <- paste(directory, specdatafiles, sep="/")

files<-list()

for(i in 1:length(specdatapaths))
  {
      files[[i]]<- read.csv(specdatapaths[i], header=T, sep=",")
}

# Save an object to a file
saveRDS(files, file = "my_data.rds")
my_data <- readRDS("~/2021/EDA/EDA workspace/EDA_Assignment3/my_data.rds")
```

```{r}
dateRange1<-ymd("2021-03-01")
my_data1<- lapply(my_data, function(x) {
  x$date <- ymd(x$date)
  x$time<-hms(x$time)
  x
})

r<-lapply(my_data1, function(x) filter(x, date==dateRange1[1]))
   #For loop
   ind<-c()
   j<-1
   for(i in 1:length(my_data1)){
      if (length(r[[i]]$date)>2){
        ind[j]<-i
        j<-j+1
      }
   }
   
b<-my_data1[ind]#gives back a list of non-empty dataframes
b<-as.data.frame(b)

```

```{r}
geo<- st_as_sf(b,coords = c("lat","lng","elevation"),crs = 4326)
my_crs <- "+proj=utm +zone=34H +datum=WGS84 +units=m +no_defs" #for Beaufort 
geo <-st_transform(geo, crs = my_crs)

dist1<-c()
for(i in 1:(length(geo$geometry)-1)){
  dist1[i]<-st_distance(geo$geometry[i],geo$geometry[i+1],'meter')
}

dist1<-c(0,dist)
geo$dist<-dist1

geo<-geo%>%mutate(tot_dist=cumsum(dist)/1000) #in meters 
tot_distance<-max(geo_test$tot_dist)

km<-seq(from=1,to=round(tot_distance),by=1)#initilize coloumn one of dataframe = the kms 

splittime<-c()
 for(i in 1:round(tot_distance)){
      new<-geo%>%filter(tot_dist<i & tot_dist>=(i-1)) #filter out the data between the two kms relevent = 1km split 
      splittime[i]<-round((new$time[length(new$time)]-new$time[1])/60)
 }
    splits_time<-as.data.frame(cbind(km,splittime))
    splits_time
    
    
elev<-max(b$elevation)-min(b$elevation) #elevation in meters
```
